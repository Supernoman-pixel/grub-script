#!/bin/bash

#BANNER

echo "                               _                           _ _      _                           _       _   "
sleep 0.4
echo "                              (_)                         | (_)    (_)                         (_)     | |  "
sleep 0.4
echo "  __ _ _ __  _ __   ___  _   _ _ _ __   __ _   _ __   ___ | |_  ___ _  ___  ___   ___  ___ _ __ _ _ __ | |_ "
sleep 0.4
echo " / _  | '_ \| '_ \ / _ \| | | | | '_ \ / _  | | '_ \ / _ \| | |/ __| |/ _ \/ __| / __|/ __| '__| | '_ \| __|"
sleep 0.4
echo "| (_| | | | | | | | (_) | |_| | | | | | (_| | | |_) | (_) | | | (__| |  __/\__ \ \__ \ (__| |  | | |_) | |_ "
sleep 0.4
echo " \__,_|_| |_|_| |_|\___/ \__, |_|_| |_|\__, | | .__/ \___/|_|_|\___|_|\___||___/ |___/\___|_|  |_| .__/ \__|"
sleep 0.4
echo "                          __/ |         __/ | | |                                                | |        "
sleep 0.4
echo "                         |___/         |___/  |_|                                                |_|        "
sleep 2

#SETTING COLORS

BG_BLACK="\033[40m"
BG_RED="\033[41m"
BG_GREEN="\033[42m"
BG_YELLOW="\033[43m"
BG_BLUE="\033[44m"
BG_MAGENTA="\033[45m"
BG_CYAN="\033[46m"
BG_WHITE="\033[47m"

# Bright Background Colors
BG_BBLACK="\033[100m"
BG_BRED="\033[101m"
BG_BGREEN="\033[102m"
BG_BYELLOW="\033[103m"
BG_BBLUE="\033[104m"
BG_BMAGENTA="\033[105m"
BG_BCYAN="\033[106m"
BG_BWHITE="\033[107m"

# Reset
RESET="\033[0m"

# CHANGING PERMISSIONS
echo -e "${BG_RED}Changing permissions for /etc/apt/*...${RESET}"
sudo find /etc/apt/ -type d -exec chmod 755 {} \;
sudo find /etc/apt/ -type f -exec chmod 644 {} \;
sudo chattr -R -ia /etc/apt
sudo chown -R root:root /etc/apt
sudo setfacl -Rb /etc/apt/*
sudo setfacl -Rb /etc/apt/*/*
echo -e "${BG_GREEN}Done!${RESET}\n"

#01autoremove
echo -e "${BG_RED}Editing 01autoremove...${RESET}"
sudo echo 'APT
{
  NeverAutoRemove
  {
	"^firmware-linux.*";
	"^linux-firmware$";
	"^linux-image-[a-z0-9]*$";
	"^linux-image-[a-z0-9]*-[a-z0-9]*$";
  };

  VersionedKernelPackages
  {
	# kernels
	"linux-.*";
	"kfreebsd-.*";
	"gnumach-.*";
	# (out-of-tree) modules
	".*-modules";
	".*-kernel";
  };

  Never-MarkAuto-Sections
  {
	"metapackages";
	"contrib/metapackages";
	"non-free/metapackages";
	"restricted/metapackages";
	"universe/metapackages";
	"multiverse/metapackages";
  };

  Move-Autobit-Sections
  {
	"oldlibs";
	"contrib/oldlibs";
	"non-free/oldlibs";
	"restricted/oldlibs";
	"universe/oldlibs";
	"multiverse/oldlibs";
  };
};
' > /etc/apt/apt.conf.d/01autoremove
echo -e "${BG_GREEN}Done!${RESET}\n"

#10periodic
echo -e "${BG_RED}Editing 10periodic...${RESET}"
sudo echo 'APT::Periodic::Update-Package-Lists "1";
APT::Periodic::Download-Upgradeable-Packages "1";
APT::Periodic::AutocleanInterval "7";
APT::Periodic::Unattended-Upgrade "1";' > /etc/apt/apt.conf.d/10periodic
echo -e "${BG_GREEN}Done!${RESET}\n"

#20archive
echo -e "${BG_RED}Editing 20archive...${RESET}"
sudo echo "APT::Archives::MaxAge "30";
APT::Archives::MinAge "2";
APT::Archives::MaxSize "500";
APT::Sandbox::Seccomp "true";" > /etc/apt/apt.conf.d/20archive
echo -e "${BG_GREEN}Done!${RESET}\n"

#20auto-upgrades
echo -e "${BG_RED}Editing 20-auto-upgrades...${RESET}"
sudo echo "APT::Periodic::Update-Package-Lists "1";
APT::Periodic::Download-Upgradeable-Packages "1";
APT::Periodic::Unattended-Upgrade "1";
APT::Periodic::AutocleanInterval "14";
APT::Get::AllowUnauthenticated "false";" > /etc/apt/apt.conf.d/20auto-upgrades
echo -e "${BG_GREEN}Done!${RESET}\n"

#50unattended-upgrades
echo -e "${BG_RED}Editing 50unattended-upgrades...${RESET}"
sudo echo "Acquire::AllowDowngradeToInsecureRepositories "false";
Acquire::AllowInsecureRepositories "false";
Unattended-Upgrade::Allow-downgrade "false";
Unattended-Upgrade::Debug "false";
Unattended-Upgrade::Verbose "true";
Unattended-Upgrade::Remove-Unused-Dependencies "true";
Unattended-Upgrade::DevRelease "false";
Unattended-Upgrade::AutoFixInterruptedDpkg "true";" >> /etc/apt/apt.conf.d/50unattended-upgrades
echo -e "${BG_GREEN}Done!${RESET}\n"

#Polkit Permissions
echo -e "${BG_RED}Editing polkit permissions...${RESET}"
sudo chmod 755 /etc/polkit-1
sudo chmod 700 /etc/polkit-1/localauthority
sudo chmod 755 /etc/polkit-1/localauthority.conf.d
sudo chmod 644 /etc/polkit-1/localauthority.conf.d/50-localauthority.conf
sudo chmod 644 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
sudo chown -R root:root /etc/polkit-1
sudo setfacl -Rb /etc/polkit-1
sudo chattr -R -ia /etc/polkit-1
echo -e "${BG_GREEN}Done!${RESET}\n"

#50-localauthority.conf
echo -e "${BG_RED}Editing 50-localauthority.conf...${RESET}"
sudo echo "# Configuration file for the PolicyKit Local Authority.
#
# DO NOT EDIT THIS FILE, it will be overwritten on update.
#
# See the pklocalauthority(8) man page for more information
# about configuring the Local Authority.
#

[Configuration]
AdminIdentities=unix-user:0
" > /etc/polkit-1/localauthority.conf.d/50-localauthority.conf
echo -e "${BG_GREEN}Done!${RESET}\n"

#51-ubuntu-admin.conf
echo -e "${BG_RED}Editing 51-ubuntu-admin.conf...${RESET}"
sudo echo "[Configuration]
AdminIdentities=unix-group:sudo;unix-group:admin
" > /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
echo -e "${BG_GREEN}Done!${RESET}\n"
